<?xml version="1.0" encoding="UTF-8" ?>
<!--
    TODO: no update.
-->
<odoo>
    <template
        id="qwb_tmpl_ubl_order_response_out"
        name="Render UBL OrderResponse out - EXAMPLE"
    >

        <OrderResponse
            xmlns="urn:oasis:names:specification:ubl:schema:xsd:OrderResponse-2"
            xmlns:cac="urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2"
            xmlns:cbc="urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2"
        >
            <cbc:UBLVersionID>2.2</cbc:UBLVersionID>
            <cbc:CustomizationID
            >urn:www.cenbii.eu:transaction:biicoretrdmXYZ:ver1.0</cbc:CustomizationID>
            <cbc:ProfileID
                schemeAgencyID="BII"
                schemeID="Profile"
            >urn:www.cenbii.eu:profile:BIIXYZ:ver1.0</cbc:ProfileID>
            <cbc:ID t-esc="record.client_order_ref" />
            <cbc:UUID t-esc="exchange_record.identifier" />
            <cbc:IssueDate
                t-esc="date_to_string(record.date_order)"
            >2010-01-21</cbc:IssueDate>
            <cbc:IssueTime
                t-esc="time_to_string(record.date_order)"
            >12:30:00</cbc:IssueTime>
            <cbc:Note t-esc="record.note" />
            <cbc:DocumentCurrencyCode
                t-esc="record.currency_id.name"
            >EUR</cbc:DocumentCurrencyCode>
            <!--
                FIXME: don't know why adding this breaks validation like

                `Unexpected child with tag 'cac:LineCountNumeric' at position 9. Tag 'cac:OrderReference' expected`

                which makes no sense since according to XSD the order is correct.

                <cac:LineCountNumeric t-esc="len(record.order_line)" />
            -->
            <cac:OrderReference>
                <cbc:ID t-esc="record.client_order_ref">XYZ123</cbc:ID>
                <cbc:SalesOrderID t-esc="record.name">SO1234</cbc:SalesOrderID>
            </cac:OrderReference>
            <cac:SellerSupplierParty>
                <t t-call="edi_sale_ubl_oca.qweb_tmpl_ubl_party">
                    <t t-set="party" t-value="seller_party" />
                </t>
            </cac:SellerSupplierParty>
            <cac:BuyerCustomerParty>
                <t t-call="edi_sale_ubl_oca.qweb_tmpl_ubl_party">
                    <t t-set="party" t-value="buyer_party" />
                </t>
            </cac:BuyerCustomerParty>
            <cac:Delivery>
                <cbc:ID t-esc="delivery.name" />
                <t
                    t-set="uoms"
                    t-value="delivery.move_line_ids.mapped('product_uom_id')"
                />
                <!-- Use UOM only if homogeneus -->
                <t t-set="uom" t-value="first_of(uoms) if len(uoms) == 1 else None" />
                <!-- TODO: get pkg qty instead? -->
                <t
                    t-if="uom"
                    t-set="total_qty"
                    t-value="sum(delivery.move_line_ids.mapped('product_uom_qty'))"
                />
                <cbc:Quantity
                    t-if="uom"
                    t-att-unitCode="uom.unece_code"
                    t-esc="total_qty"
                >1.0</cbc:Quantity>
                <cbc:ActualDeliveryDate
                    t-esc="date_to_string(record.commitment_date)"
                />
                <cbc:ActualDeliveryTime
                    t-esc="time_to_string(record.commitment_date)"
                />
                <cac:DeliveryAddress t-if="delivery.partner_id">
                    <t t-call="edi_sale_ubl_oca.qweb_tmpl_ubl_address">
                        <t t-set="partner" t-value="delivery.partner_id" />
                    </t>
                </cac:DeliveryAddress>
                <cac:RequestedDeliveryPeriod>
                    <cbc:StartDate
                        t-esc="date_to_string(record.commitment_date)"
                    >2010-02-10</cbc:StartDate>
                    <cbc:EndDate
                        t-esc="date_to_string(record.commitment_date)"
                    >2010-02-25</cbc:EndDate>
                </cac:RequestedDeliveryPeriod>
            </cac:Delivery>
            <cac:TaxTotal>
                <cbc:TaxAmount
                    t-att-currencyID="record.currency_id.name"
                    t-esc="record.amount_tax"
                />
            </cac:TaxTotal>
            <cac:LegalMonetaryTotal>
                <cbc:PayableAmount
                    t-att-currencyID="record.currency_id.name"
                    t-esc="record.amount_total"
                />
            </cac:LegalMonetaryTotal>
            <t t-foreach="record.order_line" t-as="line">
                <cac:OrderLine>
                    <cbc:SubstitutionStatusCode />
                    <cbc:Note />
                    <cac:LineItem>
                        <cbc:ID t-esc="line.edi_id">1</cbc:ID>
                        <cbc:SalesOrderID />
                        <cbc:UUID t-esc="line.id" />
                        <cbc:Note />
                        <!-- TODO -->
                        <cbc:LineStatusCode listAgencyID="UBL" listName="Line Status" />
                        <cbc:Quantity
                            t-att-unitCode="line.product_uom.unece_code"
                            t-esc="line.product_uom_qty"
                        >1</cbc:Quantity>
                        <cbc:LineExtensionAmount
                            t-att-currencyID="record.currency_id.name"
                            t-esc="line.price_subtotal"
                        />
                        <cbc:TotalTaxAmount
                            t-att-currencyID="record.currency_id.name"
                            t-esc="line.price_tax"
                        />
                        <!--
                            Dynamic support for commitment dates at line level.
                            You can add your own field or rely on `sale_order_line_date`.
                         -->
                        <cac:Delivery t-if="'commitment_date' in line._fields">
                            <cac:RequestedDeliveryPeriod>
                                <cbc:StartDate
                                    t-esc="date_to_string(line.commitment_date)"
                                >2010-02-10</cbc:StartDate>
                                <cbc:EndDate
                                    t-esc="date_to_string(line.commitment_date)"
                                >2010-02-25</cbc:EndDate>
                            </cac:RequestedDeliveryPeriod>
                        </cac:Delivery>
                        <cac:Price>
                            <cbc:PriceAmount
                                t-att-currencyID="record.currency_id.name"
                                t-field="line.price_unit"
                            />
                            <cbc:BaseQuantity>1</cbc:BaseQuantity>
                        </cac:Price>
                        <cac:Item>
                            <cbc:Description t-esc="line.name" />
                            <cac:SellersItemIdentification>
                                <cbc:ID
                                    t-esc="line.product_id.default_code or line.product_id.barcode"
                                />
                            </cac:SellersItemIdentification>
                            <!--
                                TODO: use main_seller_id.product_code
                            <cac:ManufacturersItemIdentification>
                                <cbc:ID t-esc="line.product_id.default_code"/>
                            </cac:ManufacturersItemIdentification>
                            -->
                            <cac:StandardItemIdentification>
                                <cbc:ID t-esc="line.product_id.barcode" />
                            </cac:StandardItemIdentification>
                            <t t-foreach="line.tax_id" t-as="tax">
                                <cac:ClassifiedTaxCategory
                                    t-if="tax.unece_categ_code and tax.unece_type_code"
                                >
                                    <cbc:ID t-esc="tax.unece_categ_code" />
                                    <cbc:Name t-esc="tax.name" />
                                    <cac:TaxScheme>
                                        <cbc:ID t-esc="tax.unece_type_code" />
                                    </cac:TaxScheme>
                                </cac:ClassifiedTaxCategory>
                            </t>
                        </cac:Item>
                    </cac:LineItem>
                </cac:OrderLine>
            </t>
        </OrderResponse>

    </template>
</odoo>
